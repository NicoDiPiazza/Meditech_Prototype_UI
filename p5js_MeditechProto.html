<!DOCTYPE html>
<html> 
  <head>
    <title>Processing.JS inside Webpages: Template</title> 
  </head>
  <body>
	<!--This draws the canvas on the webpage -->
    <canvas id="mycanvas"></canvas> 
	<audio id="audio" src="ring-G.mp3"></audio>
  </body>
 
  <!-- Include the processing.js library -->
  <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
  <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
  <script>




  var programCode = function(processingInstance) {
    with (processingInstance) {

	
	var screenWidth = 1400;
	var screenHeight = 600;
	noCursor();
	
      size(screenWidth, screenHeight); 
      frameRate(30);
        
      // Paste code from Khan Academy here:


	var buttonDimensions = function(givenPage){
		//takes a list of buttons from the given page and says where each one goes
		// butts used to be a shortening of buttons so that I wasn't initializing a variable twice... but now it's just for fun.
		let butts = [];
		let currentAddress = 0;
		for(j = 0; j < givenPage.Buttons.length; j++){
			NButtons = givenPage.Buttons[j][0];
			collectionX = givenPage.Buttons[j][1];
			collectionY = givenPage.Buttons[j][2];
			collectionWidth = givenPage.Buttons[j][3];
			collectionHeight = givenPage.Buttons[j][4];
			horizontal = givenPage.Buttons[j][5];

			if(horizontal == true){
				for(i = 0; i < NButtons; i++){					
					newButton = new Button(givenPage.Addresses[currentAddress], collectionX + (collectionWidth*i/NButtons) + spread/2, 
						collectionY, (collectionWidth/NButtons) - spread, 
						collectionHeight, myDarkBlue);
					butts.push(newButton);
					currentAddress++;
				};
			}
			else{
				for(i = 0; i < NButtons; i++){		
					newButton = new Button(givenPage.Addresses[currentAddress], collectionX, 
						collectionY + (collectionHeight*i/NButtons) + spread/2, (collectionWidth), 
						(collectionHeight/NButtons) - spread, myDarkBlue);
					butts.push(newButton);
					currentAddress++;
				};
			}
		}	
		return butts;
	};

	var pageDisplay = function(givenPage){

		buttDims = buttonDimensions(currentPage);

		for (i = 0; i < buttDims.length; i++){
			let color = buttDims[i].color;
			fill(color[0], color[1], color[2]);
			rect(buttDims[i].x, buttDims[i].y, buttDims[i].width, buttDims[i].height);
			fill(255);
			text(pages[buttDims[i].page].name, buttDims[i].x + buttDims[i].width/2.5, buttDims[i].y + buttDims[i].height/2.1);
		};

	}

	var mousePressed = function(){
		// anything you want to happen on a mouse click goes in here. I don't like this function.

		background(myLightBlue[0], myLightBlue[1], myLightBlue[2]);

		let hitboxes = buttonDimensions(currentPage);

		let NChecks = 0;
		for(i = 0; i< currentPage.Buttons.length; i++){
			NChecks = NChecks + currentPage.Buttons[i][0];

		};

		for (i = 0; i < hitboxes.length; i++){
			if(hitboxes[i].x <= mouseX && mouseX <= hitboxes[i].x + hitboxes[i].width){
				if(hitboxes[i].y <= mouseY && mouseY <= hitboxes[i].y + hitboxes[i].height){

					currentPage = pages[hitboxes[i].page];
					// put all the feedback stuff here
					myAudio.play()
					wait = 0;
					if(currentPage == backPage){
						if(path.length >= 1){
							path.pop();
							currentPage = path[path.length-1];
						}
						else{
							console.log('Cannot go any farther back')
							currentPage = path[0];
						}
					}
					else if(currentPage == logoutPage){
						if(path.length >= 1){
							userID = null;
							currentPage = home;
						}
						else{
							console.log('Cannot go any farther back')
							currentPage = path[0];
						}
					}
					else{
						path.push(currentPage);
					};

					
					break; // this has to go in otherwise the for loop gets REAL confused about what the current page is
				};
			};
		};

		background(myLightBlue[0], myLightBlue[1], myLightBlue[2]);
		
		
		pageDisplay(currentPage);

		pathName = '';
		for (i = 0; i < path.length; i++){
			pathName = pathName + '/' + path[i].name;
		}
		console.log(pathName);

	}


	class Button{
		constructor(page, x, y, width, height, color) {
		this.page = page;
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
		this.color = color;
  		}	
	};


	class Page{
		constructor(name, Buttons, Addresses, index){
			this.name = name;
			this.Buttons = Buttons;
			this.Addresses = Addresses;
			this.index = index;


		}

	};

	  

	var spread = 10;
	let myAudio = document.querySelector('#audio')
	let wait =0;
	let hangTime = 10;
	let cursorRadius = 50
	let path = [];
	let pathName = '';
	let userID;
	

	// hardcode pages here until pages are procedurally generated
	//button set syntax: [[NButtons, x, y, width, height, orientation], [ditto], ...]
	let home = new Page('Home', [[5, screenWidth/3, screenHeight/6, 400, 600, false]], [6, 7, 4, 5, 8], 1);

	let summaryPage = new Page ('Summary', [[1, 0, 0, 800, 200, true]], [0], 2);
	let diagnosisPage = new Page ('Diagnosis', [[1, 0, 0, 800, 200, true]], [0], 3);
	let providersPage = new Page ('Providers', [[1, 0, 0, 800, 200, true]], [0], 4);
	let medicationsPage = new Page ('Medications', [[1, 0, 0, 800, 200, true]], [0], 5);
	let patientsPage = new Page('Patients', [[5, screenWidth/3, screenHeight/4, screenWidth/3, screenHeight*2/3, false], 
											[2, screenWidth*4/5, screenHeight/8, 200, 100, true], 
											[1, screenWidth*4/5, screenHeight*4/5, 100, 100, true]],
											[2, 3, 4, 6, 7, 8, 0, 9], 6);
	let doctorsPage = new Page ('Doctors', [[4, screenWidth/3, screenHeight/4, screenWidth/3, screenHeight*2/3, false], 
											[2, screenWidth*4/5, screenHeight/8, 200, 100, true], 
											[1, screenWidth*4/5, screenHeight*4/5, 100, 100, true]],
											[6, 3, 4, 5, 7, 8, 0, 0], 7);
	let profilePage = new Page ('User Profile', [[2, 0, 0, 800, 200, true]], [0, 10], 8);
	let sharePage = new Page ('Share', [[1, 0, 0, 800, 200, true]], [0], 9);
	let backPage = new Page ('Back', [[1, 0, 0, 800, 200, true]], [0], 0);
	let logoutPage = new Page ('Logout', [[1, 0, 0, 800, 200, true]], [0], 10);


	let pages = [backPage, home, summaryPage, diagnosisPage, providersPage, medicationsPage, patientsPage, doctorsPage, profilePage,
				 sharePage, logoutPage];

	


	let currentPage = home;
	path.push(home);

	// color pallette
	var myVeryLightBlue = [224, 230, 254];
	var myLightBlue = [180, 191, 255];
	var myDarkBlue = [103, 119, 204];
	var myLightGreen = [180, 254, 166];
	var myRed = [171, 88, 98];



	draw = function(){

		background(myLightBlue[0], myLightBlue[1], myLightBlue[2]);

		if(currentPage == profilePage){
			if(userID == null){
				userID = prompt('Please enter your username:');
			}
			else{
				textSize(40);
				fill(255);

				text('Welcome ' + userID + '.', screenWidth/4, screenHeight/2);

				textSize(12);
			};	
		};

		pageDisplay(currentPage);
		fill()

		fill(255, 255, 255);
		
		if(wait<=hangTime){	
			fill(myLightGreen[0], myLightGreen[1], myLightGreen[2]);
			
			wait++;
		}
		ellipse(mouseX, mouseY, 50, 50);
		


	}
	  
	  
	    

	  
	  
	  
    }};


  // Get the canvas that ProcessingJS will use
  var canvas = document.getElementById("mycanvas"); 
  // Pass the function to ProcessingJS constructor
  var processingInstance = new Processing(canvas, programCode); 

  </script>
</html>
